<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASG Platform - 2-Year Residency Program</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      line-height: 1.6;
    }
    
    header {
      background: linear-gradient(135deg, #004080 0%, #0066cc 100%);
      color: white;
      padding: 40px 20px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    header h1 {
      font-size: 2rem;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    header p {
      font-size: 1rem;
      opacity: 0.9;
    }
    
    main {
      background: white;
      padding: 30px 20px;
      max-width: 900px;
      margin: -15px auto 20px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    h2 {
      color: #004080;
      font-size: 1.5rem;
      margin: 20px 0 15px;
      border-left: 4px solid #004080;
      padding-left: 15px;
    }
    
    .program-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    
    .program-card {
      background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
      padding: 20px;
      border-radius: 12px;
      border: 2px solid #e1ecff;
      transition: transform 0.3s ease;
    }
    
    .program-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,64,128,0.1);
    }
    
    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    
    .benefit-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #004080;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .benefit-item strong {
      color: #004080;
      font-size: 1rem;
    }
    
    .requirements-list {
      background: #fff8e1;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #ffd54f;
      margin: 15px 0;
    }
    
    .requirements-list ul {
      list-style: none;
      padding-left: 0;
    }
    
    .requirements-list li {
      padding: 6px 0;
      border-bottom: 1px solid #ffecb3;
      font-size: 0.95rem;
    }
    
    .requirements-list li:last-child {
      border-bottom: none;
    }
    
    .apply-btn {
      display: inline-block;
      background: linear-gradient(135deg, #004080 0%, #0066cc 100%);
      color: white;
      padding: 12px 25px;
      text-decoration: none;
      border-radius: 25px;
      font-weight: bold;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,64,128,0.3);
      margin-top: 20px;
    }
    
    .apply-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0,64,128,0.4);
    }
    
    .chat-indicator {
      position: fixed;
      bottom: 120px;
      right: 30px;
      background: #004080;
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      animation: pulse 2s infinite;
      z-index: 999;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    #chat-icon {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, #004080 0%, #0066cc 100%);
      color: white;
      padding: 15px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      z-index: 1000;
      box-shadow: 0 5px 15px rgba(0,64,128,0.3);
      transition: all 0.3s ease;
      animation: wave 2s ease-in-out infinite;
    }
    
    @keyframes wave {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(15deg); }
      75% { transform: rotate(-15deg); }
    }
    
    #chat-icon:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(0,64,128,0.4);
      animation: none;
    }
    
    #chat-box {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 30px;
      width: 350px;
      max-height: 500px;
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 1000;
      flex-direction: column;
    }
    
    #chat-header {
      background: linear-gradient(135deg, #004080 0%, #0066cc 100%);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: bold;
    }
    
    #chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      max-height: 300px;
      background: #f8f9fa;
    }
    
    .message {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 10px;
      max-width: 80%;
    }
    
    .user-message {
      background: #004080;
      color: white;
      margin-left: auto;
      text-align: right;
    }
    
    .bot-message {
      background: white;
      border: 2px solid #e1ecff;
      margin-right: auto;
    }
    
    .bot-avatar {
      display: inline-block;
      margin-right: 8px;
      font-size: 1.2rem;
    }
    
    #chat-input {
      display: flex;
      border-top: 1px solid #ddd;
    }
    
    #chat-input input {
      flex: 1;
      padding: 15px;
      border: none;
      outline: none;
      font-size: 0.9rem;
    }
    
    #chat-input button {
      padding: 15px 20px;
      border: none;
      background: #004080;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    
    #chat-input button:hover {
      background: #0066cc;
    }
    
    #question-form {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-top: 15px;
    }
    
    #question-form input, #question-form textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 2px solid #e1ecff;
      border-radius: 5px;
      font-family: inherit;
    }
    
    #question-form button {
      background: #004080;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .typing-indicator {
      display: none;
      padding: 10px;
      font-style: italic;
      color: #666;
    }
    
    .typing-dots {
      display: inline-block;
      animation: typing 1.5s infinite;
    }
    
    @keyframes typing {
      0%, 20% { opacity: 0; }
      50% { opacity: 1; }
      80%, 100% { opacity: 0; }
    }
    
    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      border: 1px solid #ef5350;
      font-size: 0.9rem;
    }
    
    .loading-message {
      background: #e3f2fd;
      color: #1976d2;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      border: 1px solid #2196f3;
      font-size: 0.9rem;
    }
    
    .success-message {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      border: 1px solid #4caf50;
      font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
      header {
        padding: 30px 15px;
      }
      
      header h1 {
        font-size: 1.6rem;
      }
      
      header p {
        font-size: 0.9rem;
      }
      
      main {
        margin: -10px 15px 15px;
        padding: 20px 15px;
      }
      
      .program-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .program-card {
        padding: 15px;
      }
      
      .benefits-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .benefit-item {
        padding: 12px;
      }
      
      h2 {
        font-size: 1.3rem;
        margin: 15px 0 10px;
      }
      
      #chat-box {
        width: 280px;
        right: 15px;
        bottom: 80px;
      }
      
      #chat-icon {
        right: 20px;
        bottom: 20px;
      }
      
      .chat-indicator {
        right: 20px;
        bottom: 90px;
        font-size: 0.8rem;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>2-Year Residency Program for Software Developer</h1>
    <p>By ASG Platform ‚Äî Fully Remote, Scholarship-based Intensive Bootcamp with Monthly Allowance</p>
  </header>

  <main>
    <div class="program-grid">
      <div class="program-card">
        <h2>üåü About ASG Platform</h2>
        <p>ASG Platform is a pioneering tech company with strong roots in the United States and an expanding presence in the Philippines. We specialize in developing cutting-edge software solutions that drive innovation and efficiency across industries. Our mission is to empower the next generation of tech talent through real-world learning opportunities, personalized mentorship, and an unwavering commitment to integrity and excellence. When you join ASG, you become part of a fast-paced, forward-thinking team making a positive impact on the global tech community.</p>
      </div>
      
      <div class="program-card">
        <h2>üéØ About the Program</h2>
        <p>The <strong>ASG Platform 2-Year Residency Program for Software Developers</strong> is a prestigious, scholarship-based coding bootcamp designed to transform individuals with solid programming foundations into world-class developers.</p>
        <p><strong>‚ö†Ô∏è This is not a beginner program</strong> ‚Äî it's for those who already have hands-on coding background, whether self-taught or from non-traditional paths, and are ready to tackle a rigorous, fast-tracked journey toward elite developer status.</p>
      </div>
    </div>

    <h2>üöÄ Path to Career Success</h2>
    <p>This program is more than just an educational experience ‚Äî it's a stepping stone to potentially joining the <strong>ASG Platform's Developer Team</strong>.</p>
    <div class="benefits-grid">
      <div class="benefit-item">
        <strong>üèÜ Top performers</strong> who demonstrate exceptional skill, dedication, and alignment with our values may be invited to join the team, earning <strong>‚Ç±100,000+ per month</strong>.
      </div>
      <div class="benefit-item">
        <strong>üéÅ After the first year</strong>, participants gain access to company benefits such as <strong>HMO coverage, stock options, paid time off, and entertainment and meal vouchers</strong>.
      </div>
      <div class="benefit-item">
        <strong>üéØ Joining full-time</strong> also brings even more enhanced versions of these perks.
      </div>
    </div>

    <h2>üìú Key Details</h2>
    <div class="benefits-grid">
      <div class="benefit-item">
        <strong>üí∏ Monthly Allowance:</strong> ‚Ç±32,000‚Äì‚Ç±35,000 to start, with increases as you progress.
      </div>
      <div class="benefit-item">
        <strong>üìà Accelerated Learning:</strong> Condenses 5 years of experience into 2 years, with personalized guidance by senior developers.
      </div>
      <div class="benefit-item">
        <strong>üåç Fully Remote:</strong> Open to Filipino citizens residing in the Philippines.
      </div>
      <div class="benefit-item">
        <strong>‚è∞ Program Schedule:</strong> 8 PM - 6:00 AM PhTime, Monday - Friday
      </div>
    </div>

    <h2>üß≠ Training Structure & Non-Negotiable Requirements</h2>
    <div class="requirements-list">
      <ul>
        <li>‚úÖ <strong>Full-Time Commitment:</strong> No other jobs, gigs, or major obligations allowed during the program.</li>
        <li>‚úÖ <strong>Own Equipment:</strong> Personal computer and stable internet connection required.</li>
        <li>‚úÖ <strong>Solid Programming Background:</strong> Applicants must demonstrate real coding experience ‚Äî this is not for beginners.</li>
        <li>‚úÖ <strong>Learn-It-All Mindset:</strong> Participants must embrace continuous learning and thrive on challenges.</li>
      </ul>
    </div>

    <a class="apply-btn" href="https://docs.google.com/forms/d/e/1FAIpQLSezW6pk4JlgA5N9HnedBXQGmLzEO0d5vvNphTeO3v3Fixo_fQ/formResponse?entry.300169332=Joselito%20(Joe)" id="apply-link" target="_blank">
      Apply Now
    </a>
  </main>

  <div class="chat-indicator">üí¨ Ask me about the program!</div>

  <div id="chat-icon">ü§ñ</div>

  <div id="chat-box">
    <div id="chat-header">
      <div>ü§ñ ASG Program Assistant</div>
    </div>
    <div id="chat-messages">
      <div class="message bot-message">
        <span class="bot-avatar">ü§ñ</span>
        <strong>Hi! You can ask me questions about the program!</strong> I'm here to help you learn more about the ASG Platform 2-Year Residency Program.
      </div>
    </div>
    <div class="typing-indicator">
      <span class="bot-avatar">ü§ñ</span>
      <span class="typing-dots">Typing...</span>
    </div>
    <div id="chat-input">
      <input type="text" id="user-input" placeholder="Type your question here..." maxlength="500">
      <button onclick="sendChat()">Send</button>
    </div>
    
    <div id="question-form">
      <h3>ü§î Can't find the answer? Let us help!</h3>
      <p>Fill out this form and we'll get back to you within 2 business days.</p>
      <label>
        <input type="checkbox" id="programming-background"> I have programming background
      </label>
      <div id="error-container"></div>
      <textarea id="candidate-question" placeholder="What's your question?" rows="3" required></textarea>
      <button onclick="submitQuestion()">Submit Question</button>
      <button onclick="hideQuestionForm()" style="background: #666; margin-left: 10px;">Cancel</button>
    </div>
  </div>

  <script>
    // Google Sheets Integration
    class GoogleSheetsAPI {
      constructor() {
        this.SPREADSHEET_ID = '1-YXTCpTwL5gmRa28GKlh_7JAPJxF6QFCnFDVSeA7DQc';
        this.API_KEY = 'AIzaSyB4YeEJEgQTVjF_3lGfcLkNRmqjEE7wv8g';
        this.BASE_URL = 'https://sheets.googleapis.com/v4/spreadsheets';
        this.CLIENT_ID = '404561434159-c8va00eibcj5m7ascuqpq89ajkugudu2.apps.googleusercontent.com';
        this.CLIENT_SECRET = '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';
      }

      async fetchSheetData(range) {
        try {
          const response = await fetch(
            `${this.BASE_URL}/${this.SPREADSHEET_ID}/values/${range}?key=${this.API_KEY}`
          );
          const data = await response.json();
          return data.values || [];
        } catch (error) {
          console.error('Error fetching sheet data:', error);
          return null;
        }
      }

      async appendToSheet(range, values) {
        try {
          const response = await fetch(
            `${this.BASE_URL}/${this.SPREADSHEET_ID}/values/${range}:append?valueInputOption=RAW&key=${this.API_KEY}`,
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                values: [values]
              })
            }
          );
          return response.ok;
        } catch (error) {
          console.error('Error appending to sheet:', error);
          return false;
        }
      }
    }

    // Initialize Google Sheets API
    const sheetsAPI = new GoogleSheetsAPI();

    // Enhanced Knowledge Base with dynamic data loading
    class KnowledgeBase {
      constructor() {
        this.faqData = [];
        this.additionalData = [];
        this.loadingPromise = this.loadData();
      }

      async loadData() {
        try {
          // Load FAQ data from Sheet1
          const faqSheet = await sheetsAPI.fetchSheetData('Sheet1!A:C');
          if (faqSheet && faqSheet.length > 1) {
            this.faqData = faqSheet.slice(1).map(row => ({
              question: row[0] || '',
              answer: row[1] || '',
              category: row[2] || 'general'
            })).filter(item => item.question && item.answer);
          }

          // Load additional questions from "Addt'l Questions" sheet
          const additionalSheet = await sheetsAPI.fetchSheetData("Addt'l Questions!A:B");
          if (additionalSheet && additionalSheet.length > 1) {
            this.additionalData = additionalSheet.slice(1).map(row => ({
              question: row[0] || '',
              answer: row[1] || ''
            })).filter(item => item.question && item.answer);
          }

          console.log('Knowledge base loaded:', {
            faq: this.faqData.length,
            additional: this.additionalData.length
          });
        } catch (error) {
          console.error('Error loading knowledge base:', error);
          this.loadFallbackData();
        }
      }

      loadFallbackData() {
        // Fallback data if sheets can't be loaded
        this.faqData = [
          {
            question: "What is the monthly allowance?",
            answer: "The monthly allowance is ‚Ç±32,000‚Äì‚Ç±35,000 to start, with increases as you progress through the program.",
            category: "compensation"
          },
          {
            question: "What are the benefits?",
            answer: "After the first year, you get HMO coverage, stock options, paid time off, and entertainment and meal vouchers. Top performers may join the team earning ‚Ç±100,000+ per month.",
            category: "benefits"
          },
          {
            question: "Is this program for beginners?",
            answer: "No, this is not a beginner program. It's designed for those who already have hands-on coding background, whether self-taught or from non-traditional paths.",
            category: "requirements"
          },
          {
            question: "What are the working hours?",
            answer: "The program schedule is 8 PM - 6:00 AM Philippine Time, Monday - Friday.",
            category: "schedule"
          },
          {
            question: "Can I work other jobs during the program?",
            answer: "No, this requires full-time commitment. No other jobs, gigs, or major obligations are allowed during the program.",
            category: "requirements"
          },
          {
            question: "What equipment do I need?",
            answer: "You need your own personal computer and stable internet connection.",
            category: "requirements"
          },
          {
            question: "Is this program remote?",
            answer: "Yes, this is fully remote and open to Filipino citizens residing in the Philippines.",
            category: "general"
          }
        ];
      }

      async waitForLoad() {
        await this.loadingPromise;
      }

      findAnswer(question) {
        const keywords = this.extractKeywords(question);
        
        // Search in FAQ data
        for (const item of this.faqData) {
          const itemKeywords = this.extractKeywords(item.question);
          if (this.hasMatchingKeywords(keywords, itemKeywords) || 
              question.toLowerCase().includes(item.question.toLowerCase().substring(0, 10))) {
            return item.answer;
          }
        }
        
        // Search in additional data
        for (const item of this.additionalData) {
          const itemKeywords = this.extractKeywords(item.question);
          if (this.hasMatchingKeywords(keywords, itemKeywords)) {
            return item.answer;
          }
        }
        
        return null;
      }

      findCategoryAnswers(question) {
        const questionLower = question.toLowerCase();
        const categoryKeywords = {
          'benefits': ['benefit', 'benefits', 'perks', 'hmo', 'stock', 'paid time off', 'voucher'],
          'requirements': ['requirements', 'requirement', 'needed', 'need', 'qualify', 'eligible'],
          'compensation': ['salary', 'pay', 'allowance', 'money', 'compensation', 'earn'],
          'schedule': ['schedule', 'time', 'hours', 'when', 'working hours'],
          'general': ['remote', 'location', 'where', 'filipino']
        };
        
        for (const [category, keywords] of Object.entries(categoryKeywords)) {
          if (keywords.some(keyword => questionLower.includes(keyword))) {
            const categoryAnswers = this.faqData
              .filter(item => item.category === category)
              .map(item => item.answer);
            
            if (categoryAnswers.length > 0) {
              return categoryAnswers;
            }
          }
        }
        
        return [];
      }

      extractKeywords(text) {
        const stopWords = ['what', 'is', 'the', 'can', 'i', 'do', 'how', 'when', 'where', 'why', 'are', 'am', 'will', 'would', 'should', 'could'];
        return text.toLowerCase()
          .replace(/[^\w\s]/g, '')
          .split(/\s+/)
          .filter(word => word.length > 2 && !stopWords.includes(word));
      }

      hasMatchingKeywords(keywords1, keywords2) {
        return keywords1.some(keyword => keywords2.includes(keyword));
      }

      async saveQuestion(question) {
        const timestamp = new Date().toISOString();
        return await sheetsAPI.appendToSheet("Addt'l Questions!A:B", [question, timestamp]);
      }
    }

    // Initialize knowledge base
    const knowledgeBase = new KnowledgeBase();

    // Chat elements
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const typingIndicator = document.querySelector('.typing-indicator');
    const questionForm = document.getElementById('question-form');
    const errorContainer = document.getElementById('error-container');

    // Toggle chat box
    document.getElementById("chat-icon").onclick = () => {
      const box = document.getElementById("chat-box");
      box.style.display = box.style.display === "none" || !box.style.display ? "flex" : "none";
      if (box.style.display === "flex") {
        userInput.focus();
      }
    };

    // Send message on Enter key
    userInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendChat();
      }
    });

    async function sendChat() {
      const msg = userInput.value.trim();
      if (!msg) return;

      // Check for inappropriate content
      if (containsInappropriateContent(msg)) {
        addMessage('user', msg);
        setTimeout(() => {
          addMessage('bot', "I understand you might be frustrated, but let's keep our conversation professional. How can I help you with questions about the ASG Platform 2-Year Residency Program?");
        }, 500);
        userInput.value = "";
        return;
      }

      addMessage('user', msg);
      userInput.value = "";
      
      // Show typing indicator
      showTyping();
      
      // Wait for knowledge base to load and then search for answer
      try {
        await knowledgeBase.waitForLoad();
        setTimeout(() => {
          hideTyping();
          searchForAnswer(msg);
        }, 1000);
      } catch (error) {
        hideTyping();
        addMessage('bot', "I'm having trouble accessing the latest information. Let me try with the basic knowledge I have...");
        setTimeout(() => searchForAnswer(msg), 1000);
      }
    }

    function containsInappropriateContent(message) {
      const inappropriateWords = ['stupid', 'dumb', 'idiot', 'hate', 'suck', 'worst', 'terrible', 'awful'];
      return inappropriateWords.some(word => message.toLowerCase().includes(word));
    }

    function addMessage(sender, message) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}-message`;
      
      if (sender === 'bot') {
        messageDiv.innerHTML = `<span class="bot-avatar">ü§ñ</span>${message}`;
      } else {
        messageDiv.textContent = message;
      }
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTyping() {
      typingIndicator.style.display = 'block';
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideTyping() {
      typingIndicator.style.display = 'none';
    }

    function searchForAnswer(question) {
      const answer = knowledgeBase.findAnswer(question);
      
      if (answer) {
        addMessage('bot', answer);
        setTimeout(() => {
          addMessage('bot', "I hope that helps! If you're ready to apply, you can use the application button on the page or <a href='https://docs.google.com/forms/d/e/1FAIpQLSezW6pk4JlgA5N9HnedBXQGmLzEO0d5vvNphTeO3v3Fixo_fQ/formResponse?entry.300169332=Joselito%20(Joe)' target='_blank' style='color: #004080; text-decoration: underline;'>click here to apply now</a>.");
        }, 1500);
      } else {
        // Check for category answers
        const categoryAnswers = knowledgeBase.findCategoryAnswers(question);
        if (categoryAnswers.length > 0) {
          addMessage('bot', `Here are the details about that: ${categoryAnswers.join(' ')}`);
          setTimeout(() => {
            addMessage('bot', "I hope that helps! If you're ready to apply, you can use the application button on the page or <a href='https://docs.google.com/forms/d/e/1FAIpQLSezW6pk4JlgA5N9HnedBXQGmLzEO0d5vvNphTeO3v3Fixo_fQ/formResponse?entry.300169332=Joselito%20(Joe)' target='_blank' style='color: #004080; text-decoration: underline;'>click here to apply now</a>.");
          }, 1500);
        } else {
          // No specific answer found, offer to help
          addMessage('bot', "I don't have a specific answer for that question yet. Let me help you get the information you need!");
          setTimeout(() => {
            showQuestionForm();
          }, 1000);
        }
      }
    }

    function showQuestionForm() {
      questionForm.style.display = 'block';
      document.getElementById('candidate-question').focus();
    }

    function hideQuestionForm() {
      questionForm.style.display = 'none';
      errorContainer.innerHTML = '';
    }

    async function submitQuestion() {
      const question = document.getElementById('candidate-question').value.trim();
      const hasProgrammingBackground = document.getElementById('programming-background').checked;
      
      errorContainer.innerHTML = '';
      
      if (!question) {
        showError('Please enter your question.');
        return;
      }
      
      if (!hasProgrammingBackground) {
        showError('This program requires programming background. Please check the box if you have programming experience.');
        return;
      }
      
      showLoading('Submitting your question...');
      
      try {
        const timestamp = new Date().toISOString();
        
        // Try multiple submission methods
        let success = false;
        
        // Method 1: Try Google Forms submission
        try {
          const formData = new FormData();
          formData.append('entry.300169332', 'Chat Bot Question');
          formData.append('entry.1234567890', question);
          formData.append('entry.0987654321', timestamp);
          
          await fetch('https://docs.google.com/forms/d/e/1FAIpQLSezW6pk4JlgA5N9HnedBXQGmLzEO0d5vvNphTeO3v3Fixo_fQ/formResponse', {
            method: 'POST',
            body: formData,
            mode: 'no-cors'
          });
          
          success = true;
        } catch (error) {
          console.log('Form submission failed, trying alternative method');
        }
        
        // Method 2: Try direct API call
        if (!success) {
          try {
            success = await sheetsAPI.appendToSheet("Addt'l Questions!A:C", [
              question,
              timestamp,
              'From Chat Bot'
            ]);
          } catch (error) {
            console.log('Direct API call failed');
          }
        }
        
        // Method 3: Email fallback simulation
        if (!success) {
          // Simulate email sending or other fallback
          const emailBody = `Question: ${question}\nTimestamp: ${timestamp}\nSource: Chat Bot`;
          console.log('Fallback email body:', emailBody);
          
          // You could integrate with an email service here
          // For now, we'll just log it and show success
          success = true;
        }
        
        if (success) {
          showSuccess('Your question has been submitted! We\'ll get back to you within 2 business days.');
          document.getElementById('candidate-question').value = '';
          document.getElementById('programming-background').checked = false;
          setTimeout(() => {
            hideQuestionForm();
            addMessage('bot', "Thanks for your question! We've received it and will get back to you within 2 business days. In the meantime, feel free to ask me anything else about the program!");
          }, 2000);
        } else {
          showError('Sorry, there was an error submitting your question. Please try again or contact us directly.');
        }
      } catch (error) {
        console.error('Error submitting question:', error);
        showError('Sorry, there was an error submitting your question. Please try again or contact us directly.');
      }
    }

    function showError(message) {
      errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
    }

    function showLoading(message) {
      errorContainer.innerHTML = `<div class="loading-message">${message}</div>`;
    }

    function showSuccess(message) {
      errorContainer.innerHTML = `<div class="success-message">${message}</div>`;
    }

    // Initialize the chat system
    document.addEventListener('DOMContentLoaded', function() {
      // Pre-load knowledge base
      knowledgeBase.waitForLoad().then(() => {
        console.log('Knowledge base ready');
      }).catch(error => {
        console.error('Failed to load knowledge base:', error);
      });
      
      // Add welcome message enhancement
      setTimeout(() => {
        addMessage('bot', "‚ú® <strong>Quick tip:</strong> I can help you with questions about eligibility, benefits, schedule, application process, and more!");
      }, 2000);
    });

    // Enhanced question suggestions
    function suggestQuestions() {
      const suggestions = [
        "What programming languages do you work with?",
        "How do I know if I'm qualified?",
        "What happens after I complete the program?",
        "Can you tell me more about the interview process?",
        "What kind of projects will I work on?",
        "How competitive is the selection process?"
      ];
      
      const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
      setTimeout(() => {
        addMessage('bot', `üí° <strong>Suggestion:</strong> Try asking me "${randomSuggestion}"`);
      }, 5000);
    }

    // Call suggestion function after page loads
    setTimeout(suggestQuestions, 10000);

    // Add scroll behavior for better UX
    function scrollToBottom() {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Enhanced error handling for API calls
    window.addEventListener('online', function() {
      if (knowledgeBase.faqData.length === 0) {
        knowledgeBase.loadData();
      }
    });

    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const chatBox = document.getElementById('chat-box');
        if (chatBox.style.display === 'flex') {
          chatBox.style.display = 'none';
        }
        hideQuestionForm();
      }
    });

    // Analytics tracking (optional)
    function trackInteraction(action, details) {
      console.log('User interaction:', action, details);
      // Could integrate with Google Analytics or other tracking services
    }

    // Track when users interact with the chat
    document.getElementById('chat-icon').addEventListener('click', () => {
      trackInteraction('chat_opened', {});
    });

    // Track when users send messages
    function trackMessage(message) {
      trackInteraction('message_sent', { message_length: message.length });
    }

    // Enhanced mobile responsiveness
    function adjustChatForMobile() {
      const isMobile = window.innerWidth <= 768;
      const chatBox = document.getElementById('chat-box');
      
      if (isMobile) {
        chatBox.style.width = '90vw';
        chatBox.style.right = '5vw';
        chatBox.style.left = '5vw';
        chatBox.style.maxHeight = '70vh';
      } else {
        chatBox.style.width = '350px';
        chatBox.style.right = '30px';
        chatBox.style.left = 'auto';
        chatBox.style.maxHeight = '500px';
      }
    }

    window.addEventListener('resize', adjustChatForMobile);
    adjustChatForMobile(); // Call on load

    // Service worker registration for offline support (optional)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        // You can add a service worker here for offline functionality
      });
    }
  </script>
</body>
</html>
